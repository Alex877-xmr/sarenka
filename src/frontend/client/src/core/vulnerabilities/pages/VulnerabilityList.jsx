import { useEffect, useState } from "react";
import Navbar from "../../../shared/navbar/Navbar";
import Sidebar from "../../../shared/sidebar/Sidebar";
import Loading from "../../../shared/loading/Loading";
import VulnerabilitiesTable from "../components/VulnerabilitiesTable";
import { getAllVulnerabilities } from "../../../lib/api-vulnerabilities";

const VulnerabilityList = () => {
  const currentPage = "vulnerabilities";
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [pageNumber, setPageNumber] = useState(1);

  useEffect(() => {
    const fetchVulnerabilities = async () => {
      try {
        const listItems = await getAllVulnerabilities();
        setData(listItems.cves);
        console.log(data);
        console.log(typeof data);
        setLoading(false);
      } catch (error) {
        console.log("[ERROR] vulenrability list: ", error);
        setLoading(false);
      }
    };

    fetchVulnerabilities();
  }, [loading]);

  if (loading || !data) {
    return <Loading currentPage={currentPage} />;
  }

  return (
    <>
      <Sidebar currentPage={currentPage} />
      <main>
        <Navbar />
        <div className="main__container">
          <section className="vulnerabilities-section">
            {/* data musi być listą */}
            <VulnerabilitiesTable
              vulnerabilities={data}
              pageNumber={pageNumber}
              setPageNumber={setPageNumber}
            />
          </section>
        </div>
      </main>
    </>
  );
};

export default VulnerabilityList;
